<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
  <head>
    <meta content="text/html; charset=windows-1252" http-equiv="content-type">
    <meta name="generator" content="Bluefish 2.2.7" >
    <title>Laurux . Serveur</title>
    <meta name="CREATED" content="20040403;10240700">
    <meta name="CHANGED" content="20040404;10390700">
    <meta name="robots" content="noindex">
    <style><!-- A:link { color: #0000ff }
A:visited { color: #800080 }
--></style>
  </head>
  <body style="      background-image: url(sand.jpg);" link="#0000ff" vlink="#800080">
    <table class="header" cellspacing="0" width="100%">
      <tbody>
        <tr valign="bottom">
          <td rowspan="2" class="header" align="left">
            <h1> ~ Gestion Laurux ~ </h1>
          </td>
          <td class="header"><br>
          </td>
        </tr>
        <tr valign="bottom">
          <td class="header" align="left">
            <p><img src="Larus.gif" height="80" width="70"></p>
          </td>
        </tr>
      </tbody>
    </table>
    <p>&nbsp;</p>
    <h2>Serveur de mises à jour entre deux sites distants.</h2>
    <ul>
      <ul>
        <li><a href="Serveur.html#Principe">Principe</a> </li>
        <li><a href="Serveur.html#Mise%20en%20place">Mise place.</a></li>
        <li><a href="Serveur.html#Utilisation">Utilisation.</a></li>
        <a href="Serveur.html#Utilisation"> </a>
        <li><a href="Serveur.html#Detail">Détail des fichiers concernés par le
            programme.<br>
          </a></li>
        <a href="Serveur.html#Detail"> </a>
      </ul>
      <a href="Serveur.html#Detail"> </a>
    </ul>
    <a href="Serveur.html#Detail"> </a>
    <h3><a name="Principe">Principe.</a></h3>
    <dir>
      <p align="justify"><a name="Principe">&nbsp;&nbsp;&nbsp; La mise en place
          d'un serveur de mises à jour met en relation deux serveurs distants
          afin d'effectuer la mise à jour de certaines tables (Articles,
          familles, fournisseurs, clients etc...). Ces mises à jour se font par
          l'intermédiaire de fichiers situés sur un serveur d'échange. Les mises
          à jour sont faites en cas de création, de modification ou de
          suppression.<br>
          &nbsp;&nbsp;&nbsp; Il faudra définir un serveur (celui qui fait les
          mises à jour, nommé serveur dans cette documentation) en export et un
          autre en import (celui qui réceptionne les mises à jour, nommé client
          dans cette documentation). Ces déclarations se feront dans les
          fichiers de configuration des deux postes (préférences de Laurux).<br>
          &nbsp;&nbsp;&nbsp; Les mises à jour se feront toujours du serveur vers
          le client hormis pour les suppressions des comptes clients qui se
          feront manuellement sur chaque poste pour des raisons de contrôles
          avec la comptabilité.</a></p>
      <h3 style="text-align: justify; margin-left: -40px;"><a name="Mise en place">Mise
          en place. </a></h3>
    </dir>
    <dir></dir>
    <div style="text-align: center;"><img alt="Prefs4" src="Prefs4.png"></div>
    <dir><br>
      <br>
      <br>
      <p align="justify">&nbsp;&nbsp;&nbsp; <i><b>Coté serveur</b></i> : Aller
        dans les préférences, onglet Gestion (2) et renseigner les zones utiles.
        On cochera impérativement les boutons "Export" et "Gestion du serveur de
        mises à jour". On renseignera ensuite le chemin du serveur d'échange de
        fichiers et on sélectionnera les types de fichiers a mettre à jour.
        Articles, fournisseurs ou clients.<br>
        &nbsp;&nbsp;&nbsp; NB : Le choix de la mise à jour des articles implique
        une mise à jour automatique de toutes les tables inhérentes. Codes
        barre, codes équivalents, articles de remplacement, familles, documents
        liés etc...<br>
        &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; Le choix des articles, des
        fournisseurs et des clients implique une mise à jour automatique des
        document liés , il faudra donc mettre ces documents dans un répertoire
        d'échange accessible par l'ensemble des postes de travail.
          <br> &nbsp;&nbsp;&nbsp; <i><b>Coté client</b></i> il&nbsp; faudra
          aller dans les préférences, onglet Gestion (2) et remplir les zones
          utiles notamment le bouton "Import". Ensuite, il faudra dupliquer le
          fichier de configuration ~/.config/gambas3/Laurux3.conf en
          ~/.config/gambas3/Serveur-Maj.conf. C'est ce fichier de configuration
          qu'utilisera le programme Serveur-Maj qui effectue les mises à jour
          depuis les fichiers d'échanges générés par le serveur.&nbsp;Attention! il faut conserver le fichier d'origine Laurux3.conf<br>
        &nbsp;&nbsp;&nbsp; Le programme qui assure la mise à jour coté client se nomme Serveur-Maj.gambas et devra être lancé à partir d'un cron
        programmé pour se lancer toutes les 10,20,30 minutes ou plus selon les
        besoins de chacun.<br>
        &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Exemple de fichier cron:<br>
        &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Editer le fichier /etc/crontab<br>
        &nbsp;&nbsp;&nbsp; <span style="font-family: monospace; font-style: italic;"></span><span
          style="font-style: italic;">&nbsp;&nbsp;&nbsp; sudo nano /etc/crontab</span>
        <br>
        &nbsp;&nbsp;&nbsp; Copier la ligne suivante : */10&nbsp; * * * * *&nbsp;
        ~/Laurux3/Serveur-Maj.gambas &gt; /tmp/result 2&gt;&amp;1 &nbsp; # Mises
        à jour des données toutes les 10 mn<br>
        &nbsp;&nbsp;&nbsp; Sauvegarder, Ctrl + O et fermer l'éditeur Ctrl + X<br>
        &nbsp;&nbsp;&nbsp; Ce cron va lancer l'exécutable
        ~/Laurux3/Serveur-Maj.gambas toutes les 10 minutes de 0 heures à 24
        heures. Si un message d'erreur est détecté alors il sera placé dans le
        fichier result sous /tmp&nbsp; <br>
      </p>
      <h3 style="text-align: justify; margin-left: -40px;"><a name="Utilisation">Utilisation.</a></h3>
      <p style="margin-left: -40px;" align="justify"> &nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp; <i><b>Coté serveur</b></i> chaque création ou
        modification de fiche va générer une écriture dans un fichier de
        mouvements propre à chaque type de données. Par exemple pour les
        produits le fichier s'appelera Art_Serveur.txt, les codes barres
        CB_Serveur.txt, les documents liés pour les articles DocA_Serveur.txt,
        pour les clients Cli_Serveur.txt etc...<br>
        &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; <i><b>Coté client</b></i>, le programme
        Serveur-Maj.gambas va contrôler à son lancement la présence d'un fichier
        Maj.lock. C'est un fichier qui est créé au lancement de ce programme
        puis qui est effacé à sa fermeture. Si entre deux sessions du cron le
        programme n'a pas eu le temps de finir son traitement ou bien si le
        traitement s'est arrété d'une façon anormale alors il ne se lancera pas
        et il affichera un message signalant l'anomalie. Par conséquent, le matin en arrivant au travail, en cas de message à l'écran il faudra supprimer le fichier Maj.lock situé sous le répertoire d'échange.
        Dès lors que ce fichier n'existe pas le programme Serveur-Maj.gambas va renommer le fichier de travail et effectuera ses
        mises à jour à partir de cette nouvelle copie. Par exemple
        Art_Serveur.txt va devenir Art.txt. Cela pemettra au serveur d'alimenter
        ses fichiers d'échange pendant que le client fera ses traitements de
        mises à jour.</p>
      <p style="margin-left: -40px;" align="justify">&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp; <u><b>Important :</b></u> Lors des suppressions
        d'articles, de familles ou de fournisseurs des contrôles sont effectués
        pour s'assurer que la fiche en question ne soit pas utilisée dans une
        table autre. Par exemple pour un fournisseur, le compte a supprimer ne
        doit pas être utilisé en commande, en fiche produit etc... Si une fiche
        ne peut pas être supprimée alors une ligne de rapport sera portée dans
        un fichier nommé ErreurS.txt situé sous le répertoire d'échanges défini
        dans les préférences. Il faudra donc prendre connaissance de ce fichier
        régulièrement et effacer les lignes qui n'auront plus lieu d'être suite
        à un traitement manuel ultérieur.</p>
         <p style="margin-left: -40px;" align="justify">&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp; <u><b>Important :</b></u> En cas de changement de taux de TVA la modification devra se faire sur chaque site.</p>
      <p style="margin-left: -40px;" align="justify"><br>
      <p style="margin-left: -40px;" align="justify">&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp; <u><b>Important :</b></u> Coté client le traitement des mises à jour est transparent pour l'utilisateur. Hormis lors d'erreurs, aucune notification n'est faite, tout se fait en arrière plan.</p>
      <p style="margin-left: -40px;" align="justify"><br>
      </p>
      <h3 style="text-align: justify; margin-left: -40px;"><a name="Detail">Détails
          des fichiers mis à jour.<br>
          <br>
        </a></h3>
    </dir>
    <p><a name="Detail">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        Articles (Création, modification, suppression)<br>
        &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Fournisseurs (Création, modification, suppression)
        NB : Les contacts sont aussi concernés.<br>
        &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Clients (Création, modification) NB : Les contacts sont aussi concernés.<br>
        &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Familles (Création, modification, suppression)<br>
        &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Codes barre (Création, modification, suppression)<br>
        &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Codes équivalents (Création, modification, suppression<br>
        &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Articles de remplacement (Création, modification, suppression)<br>
        &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Les tables des étiquettes produits et gondole lors des mises à jour de prix<br>
        &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Documents liés des produits, fournisseurs et clients. (Création,
        suppression)</a></p>
    <p><br>
    </p>
    <p><br>
    </p>
    <dir> </dir>
    <a name="Serveur&gt;&lt;i&gt;&lt;font color=" #00ff00"="">
      <p align="center">----------------------------------------------------------------------------------------------------------------------</p>
    </a>
    <h3><a name="Serveur&gt;&lt;i&gt;&lt;font color=" #00ff00"=""> </a> </h3>
    <p><a href="Serveur.html">retour en haut de la page</a><font color="#0000ff">
      </font></p>
    <p><a href="LauruxIndexParCategories.html">Retour a l'index</a><font color="#0000ff">
      </font></p>
  </body>
</html>
